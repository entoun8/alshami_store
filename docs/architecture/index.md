# Alshami Store Brownfield Enhancement Architecture

## Table of Contents

- [Alshami Store Brownfield Enhancement Architecture](#table-of-contents)
  - [Table of Contents](./table-of-contents.md)
  - [1. Existing Project Analysis](./1-existing-project-analysis.md)
    - [Current Project State](./1-existing-project-analysis.md#current-project-state)
    - [Available Documentation](./1-existing-project-analysis.md#available-documentation)
    - [Identified Constraints](./1-existing-project-analysis.md#identified-constraints)
  - [2. Enhancement Scope and Integration Strategy](./2-enhancement-scope-and-integration-strategy.md)
    - [Enhancement Overview](./2-enhancement-scope-and-integration-strategy.md#enhancement-overview)
    - [Integration Approach](./2-enhancement-scope-and-integration-strategy.md#integration-approach)
      - [Code Integration Strategy](./2-enhancement-scope-and-integration-strategy.md#code-integration-strategy)
      - [Database Integration](./2-enhancement-scope-and-integration-strategy.md#database-integration)
      - [API Integration](./2-enhancement-scope-and-integration-strategy.md#api-integration)
      - [UI Integration](./2-enhancement-scope-and-integration-strategy.md#ui-integration)
    - [Compatibility Requirements](./2-enhancement-scope-and-integration-strategy.md#compatibility-requirements)
    - [Performance Constraints](./2-enhancement-scope-and-integration-strategy.md#performance-constraints)
  - [3. Tech Stack](./3-tech-stack.md)
    - [Existing Technology Stack](./3-tech-stack.md#existing-technology-stack)
    - [New Technology Additions](./3-tech-stack.md#new-technology-additions)
    - [shadcn/ui Components to Install](./3-tech-stack.md#shadcnui-components-to-install)
    - [Environment Variables (New)](./3-tech-stack.md#environment-variables-new)
  - [4. Data Models and Schema Changes](./4-data-models-and-schema-changes.md)
    - [Existing Database Schema (Verified via Supabase MCP)](./4-data-models-and-schema-changes.md#existing-database-schema-verified-via-supabase-mcp)
    - [New Data Models](./4-data-models-and-schema-changes.md#new-data-models)
    - [Schema Integration Strategy](./4-data-models-and-schema-changes.md#schema-integration-strategy)
      - [Database Changes Required](./4-data-models-and-schema-changes.md#database-changes-required)
      - [RLS Policy Design (Story 1.1)](./4-data-models-and-schema-changes.md#rls-policy-design-story-11)
      - [Function Security Fixes](./4-data-models-and-schema-changes.md#function-security-fixes)
    - [Backward Compatibility](./4-data-models-and-schema-changes.md#backward-compatibility)
    - [Supabase Storage Bucket (Story 1.9)](./4-data-models-and-schema-changes.md#supabase-storage-bucket-story-19)
  - [5. Component Architecture](./5-component-architecture.md)
    - [New Components](./5-component-architecture.md#new-components)
      - [SearchCommand Component (Story 1.4)](./5-component-architecture.md#searchcommand-component-story-14)
      - [UserProfileForm Component (Story 1.3)](./5-component-architecture.md#userprofileform-component-story-13)
      - [OrderHistoryList Component (Story 1.5)](./5-component-architecture.md#orderhistorylist-component-story-15)
      - [AdminProductTable Component (Story 1.8)](./5-component-architecture.md#adminproducttable-component-story-18)
      - [AdminProductForm Component (Story 1.8)](./5-component-architecture.md#adminproductform-component-story-18)
      - [ImageUpload Component (Story 1.9)](./5-component-architecture.md#imageupload-component-story-19)
    - [Component Interaction Diagram](./5-component-architecture.md#component-interaction-diagram)
    - [Existing Component Modifications](./5-component-architecture.md#existing-component-modifications)
    - [Component Patterns to Follow](./5-component-architecture.md#component-patterns-to-follow)
  - [6. API Design and Integration](./6-api-design-and-integration.md)
    - [API Integration Strategy](./6-api-design-and-integration.md#api-integration-strategy)
    - [New Server Actions (lib/actions.ts)](./6-api-design-and-integration.md#new-server-actions-libactionsts)
      - [updateUserProfile](./6-api-design-and-integration.md#updateuserprofile)
      - [createProduct (Admin)](./6-api-design-and-integration.md#createproduct-admin)
      - [updateProduct (Admin)](./6-api-design-and-integration.md#updateproduct-admin)
      - [deleteProduct (Admin)](./6-api-design-and-integration.md#deleteproduct-admin)
      - [uploadProductImage (Admin)](./6-api-design-and-integration.md#uploadproductimage-admin)
    - [New Data Service Functions (lib/data-service.ts)](./6-api-design-and-integration.md#new-data-service-functions-libdata-servicets)
      - [getUserOrders](./6-api-design-and-integration.md#getuserorders)
      - [searchProducts](./6-api-design-and-integration.md#searchproducts)
    - [Route Handler: Stripe Webhook](./6-api-design-and-integration.md#route-handler-stripe-webhook)
    - [External API Integration: Resend Email](./6-api-design-and-integration.md#external-api-integration-resend-email)
    - [Existing Stripe Integration Update](./6-api-design-and-integration.md#existing-stripe-integration-update)
  - [7. Source Tree](./7-source-tree.md)
    - [Existing Project Structure (Relevant Parts)](./7-source-tree.md#existing-project-structure-relevant-parts)
    - [New File Organization](./7-source-tree.md#new-file-organization)
    - [Integration Guidelines](./7-source-tree.md#integration-guidelines)
    - [New Files Summary](./7-source-tree.md#new-files-summary)
    - [Modified Files Summary](./7-source-tree.md#modified-files-summary)
    - [Route Structure After Enhancement](./7-source-tree.md#route-structure-after-enhancement)
  - [8. Infrastructure and Deployment Integration](./8-infrastructure-and-deployment-integration.md)
    - [Existing Infrastructure](./8-infrastructure-and-deployment-integration.md#existing-infrastructure)
    - [Enhancement Deployment Strategy](./8-infrastructure-and-deployment-integration.md#enhancement-deployment-strategy)
      - [Target Infrastructure](./8-infrastructure-and-deployment-integration.md#target-infrastructure)
      - [Deployment Approach](./8-infrastructure-and-deployment-integration.md#deployment-approach)
      - [Infrastructure Changes Required](./8-infrastructure-and-deployment-integration.md#infrastructure-changes-required)
      - [Pipeline Integration](./8-infrastructure-and-deployment-integration.md#pipeline-integration)
    - [Environment Variables Configuration](./8-infrastructure-and-deployment-integration.md#environment-variables-configuration)
      - [Development (.env.local)](./8-infrastructure-and-deployment-integration.md#development-envlocal)
      - [Production (Vercel Environment Variables)](./8-infrastructure-and-deployment-integration.md#production-vercel-environment-variables)
    - [Rollback Strategy](./8-infrastructure-and-deployment-integration.md#rollback-strategy)
      - [Risk Mitigation](./8-infrastructure-and-deployment-integration.md#risk-mitigation)
    - [Monitoring Approach](./8-infrastructure-and-deployment-integration.md#monitoring-approach)
    - [Pre-Deployment Checklist (Story 1.10)](./8-infrastructure-and-deployment-integration.md#pre-deployment-checklist-story-110)
  - [9. Coding Standards](./9-coding-standards.md)
    - [Existing Standards Compliance](./9-coding-standards.md#existing-standards-compliance)
    - [UI Development Standards (from CLAUDE.md)](./9-coding-standards.md#ui-development-standards-from-claudemd)
      - [1. Component Library - shadcn/ui ONLY](./9-coding-standards.md#1-component-library-shadcnui-only)
      - [2. Color System - CSS Variables ONLY](./9-coding-standards.md#2-color-system-css-variables-only)
      - [3. Layout -  Class](./9-coding-standards.md#3-layout-class)
      - [4. Typography - Predefined Classes](./9-coding-standards.md#4-typography-predefined-classes)
    - [Enhancement-Specific Standards](./9-coding-standards.md#enhancement-specific-standards)
      - [Server Components vs Client Components](./9-coding-standards.md#server-components-vs-client-components)
      - [Server Actions Pattern](./9-coding-standards.md#server-actions-pattern)
      - [Form Handling Pattern](./9-coding-standards.md#form-handling-pattern)
      - [Price Handling](./9-coding-standards.md#price-handling)
    - [Critical Integration Rules](./9-coding-standards.md#critical-integration-rules)
    - [Import Organization](./9-coding-standards.md#import-organization)
    - [Admin-Specific Standards](./9-coding-standards.md#admin-specific-standards)
    - [Webhook-Specific Standards](./9-coding-standards.md#webhook-specific-standards)
  - [10. Testing Strategy](./10-testing-strategy.md)
    - [Integration with Existing Tests](./10-testing-strategy.md#integration-with-existing-tests)
    - [New Testing Requirements](./10-testing-strategy.md#new-testing-requirements)
      - [Manual Testing Approach](./10-testing-strategy.md#manual-testing-approach)
        - [Story 1.1: RLS Policies - Test Cases](./10-testing-strategy.md#story-11-rls-policies-test-cases)
        - [Story 1.2: Home Redirect - Test Cases](./10-testing-strategy.md#story-12-home-redirect-test-cases)
        - [Story 1.3: User Profile - Test Cases](./10-testing-strategy.md#story-13-user-profile-test-cases)
        - [Story 1.4: Product Search - Test Cases](./10-testing-strategy.md#story-14-product-search-test-cases)
        - [Story 1.5: Order History - Test Cases](./10-testing-strategy.md#story-15-order-history-test-cases)
        - [Story 1.6: Stripe Webhook - Test Cases](./10-testing-strategy.md#story-16-stripe-webhook-test-cases)
        - [Story 1.7: Order Confirmation Email - Test Cases](./10-testing-strategy.md#story-17-order-confirmation-email-test-cases)
        - [Story 1.8: Admin Dashboard - Test Cases](./10-testing-strategy.md#story-18-admin-dashboard-test-cases)
        - [Story 1.9: Image Upload - Test Cases](./10-testing-strategy.md#story-19-image-upload-test-cases)
        - [Story 1.10: Production Deployment - Test Cases](./10-testing-strategy.md#story-110-production-deployment-test-cases)
    - [Integration Tests (Manual)](./10-testing-strategy.md#integration-tests-manual)
    - [Regression Testing](./10-testing-strategy.md#regression-testing)
    - [Automated Testing Recommendation (Future)](./10-testing-strategy.md#automated-testing-recommendation-future)
  - [11. Security Integration](./11-security-integration.md)
    - [Existing Security Measures](./11-security-integration.md#existing-security-measures)
    - [Current Security Issues (from Supabase Advisors)](./11-security-integration.md#current-security-issues-from-supabase-advisors)
    - [Enhancement Security Requirements](./11-security-integration.md#enhancement-security-requirements)
      - [Defense in Depth Strategy](./11-security-integration.md#defense-in-depth-strategy)
      - [New Security Measures](./11-security-integration.md#new-security-measures)
    - [Security Implementation Details](./11-security-integration.md#security-implementation-details)
      - [1. Row Level Security Policies (Story 1.1)](./11-security-integration.md#1-row-level-security-policies-story-11)
      - [2. Admin Authorization Flow](./11-security-integration.md#2-admin-authorization-flow)
      - [3. Webhook Security](./11-security-integration.md#3-webhook-security)
      - [4. Service Role Key Isolation](./11-security-integration.md#4-service-role-key-isolation)
      - [5. Input Validation Security](./11-security-integration.md#5-input-validation-security)
      - [6. Environment Variable Security](./11-security-integration.md#6-environment-variable-security)
    - [Security Testing Requirements](./11-security-integration.md#security-testing-requirements)
    - [Compliance Considerations](./11-security-integration.md#compliance-considerations)
    - [Security Incident Response](./11-security-integration.md#security-incident-response)
  - [12. Architecture Checklist Results](./12-architecture-checklist-results.md)
    - [Brownfield-Specific Validation](./12-architecture-checklist-results.md#brownfield-specific-validation)
    - [Architecture Completeness](./12-architecture-checklist-results.md#architecture-completeness)
    - [Open Items / Risks](./12-architecture-checklist-results.md#open-items-risks)
  - [13. Next Steps](./13-next-steps.md)
    - [Story Manager Handoff](./13-next-steps.md#story-manager-handoff)
    - [Developer Handoff](./13-next-steps.md#developer-handoff)
    - [Implementation Sequence Diagram](./13-next-steps.md#implementation-sequence-diagram)
  - [14. Change Log](./14-change-log.md)
